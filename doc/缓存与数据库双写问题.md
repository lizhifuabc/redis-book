# 缓存与数据库双写问题

为什么要删除缓存而不是更新缓存:

>因为这样是最简单的，不用考虑很多复杂的情况。

二种方式：

- 先更新数据库，再删除缓存
- 先删除缓存，再更新数据库
- 延迟双删

## 先更新数据库，再删除缓存

问题：

- 更新数据库成功，但是缓存删除失败，那么缓存数据就无法保持一致性

- 缓存如果存在有效期

  ![image-20210824121129236](%E7%BC%93%E5%AD%98%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8C%E5%86%99%E9%97%AE%E9%A2%98/image-20210824121129236.png)

##先删除缓存，再更新数据库

问题：

- 删除缓存成功，此时另一个请求发现缓存已经为空了，此时去请求数据库获取最新数据，那么等到数据库更新成功，就出现了缓存不一致的问题。

## 延迟双删

其实依旧是先删除缓存，再更新数据库，唯一不同的是，我们把这个删除的动作，在不久之后再执行一次。

问题：

- 其实和先删除缓存，再更新数据库的问题是一样的，不同的是，可以大大的减少缓存数据不一致的请求次数。